# 5.0.0 to 5.1.0

## 5.0.0 to 5.1.0

#### Overview <a href="#user-content-overview" id="user-content-overview"></a>

This page details out the jobs required to be run as part of the upgrade from Sunbird Ed and CoKreat release 5.0.0 to release 5.1.0. Use the following table to understand the jobs that need to be executed in order to successfully complete the upgrade. Any jenkins job configuration or pre-requisites mentioned under manual configuration section needs to be done first before running any of the mentioned jobs. The order of the jobs should also be run as shown below. They can be run in parallel to speed up the execution.



**Create cname for storage account**

Create custom domain for storage account and update variables Before starting deployments.

Below are the steps to add custom domain to storage account

For Azure [Click Here](https://project-sunbird.atlassian.net/wiki/spaces/DevOps/pages/3250421819/Map+a+custom+domain+to+an+Azure+Blob+Storage+endpoint+with+HTTPS+enabled) , AWS [Click Here](https://project-sunbird.atlassian.net/wiki/spaces/DevOps/pages/3252289645/AWS+-+Add+cname+to+s3+bucket) , for GCP [Click Here](https://project-sunbird.atlassian.net/wiki/spaces/DevOps/pages/3253698597/GCP+-+Add+custom+domain+to+Storage+bucket)



**Build and Deploy for Sunbird**

| Service to be Build                         | Build Tag            | Service to Deploy                        | Deploy Tag                                                                             | Comments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------------- | -------------------- | ---------------------------------------- | -------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                             |                      | Deploy/Kubernetes/UploadSchema           | kp\_branch\_or\_tag:release-5.2.0\_RC3, branch\_or\_tag: release-5.1.0\_RC6            | Deploy this before deploying the service and flink-jobs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                             |                      | Deploy/KnowledgePlatform/KafkaSetup      | release-5.2.0\_RC8                                                                     | Deploy this before deploying flink-jobs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Build/KnowledgePlatform/SyncTool            | release-5.2.0\_RC9   |                                          |                                                                                        | **migratecspdata** - **** Add this command to the command list in the Deploy/KnowledgePlatform/Neo4jElasticSearchSyncTool Jenkins job.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Build/Core/Content                          | release-5.2.0\_RC5   | Deploy/Kubernetes/Content                | release-5.1.0\_RC6                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Core/Taxonomy                         | release-5.2.0\_RC5   | Deploy/Kubernetes/Taxonomy               | release-5.1.0\_RC6                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Core/Dial                             | release-5.2.0\_RC1   | Deploy/Kubernetes/Dial                   | release-5.1.0\_RC6                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/KnowledgePlatform/Learning            | elease-5.2.0\_RC9    | Deploy/KnowledgePlatform/Learning        | release-5.2.0\_RC9                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Core/KnowledgeMW                      | release-5.2.0\_RC1   | Deploy/Kubernetes/KnowledgeMW            | release-5.1.0\_RC6                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/KnowledgePlatform/FlinkJobs           | release-5.2.0\_RC11  | Deploy/KnowledgePlatform/FlinkJobs       | release-5.2.0\_RC8                                                                     | <p>Add the below job list to the <em>job_names_to_deploy</em> list in the Deploy/KnowledgePlatform/FlinkJobs jenkins job</p><p><strong>csp-migrator,</strong> </p><p><strong>live-node-publisher,</strong> </p><p><strong>live-video-stream-generator,</strong> </p><p><strong>cassandra-data-migration</strong> </p><p></p><p>Deploy the </p><p><strong>assessment-enrichment</strong>, </p><p><strong>content-publish</strong>, </p><p><strong>qrcode-image-generator</strong>, <strong>search-indexer</strong>, </p><p><strong>csp-migrator,</strong> </p><p><strong>live-node-publisher,</strong> </p><p><strong>live-video-stream-generator,</strong> </p><p><strong>cassandra-data-migration</strong> flink jobs. </p> |
|                                             |                      | Deploy/Kubernetes/InquiryUploadSchema    | schema\_repo\_branch\_or\_tag: release-5.2.0\_RC2 source\_folder: question,questionset | Create jenkins jobs from [config](https://github.com/Sunbird-inQuiry/inquiry-api-service/tree/release-5.2.0/scripts/jenkins-jobs/Deploy/Kubernetes/InquiryUploadSchema)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Build/Core/Assessment                       | release-5.2.0\_RC3   | Deploy/Kubenetes/Assessment              | release-5.1.0\_RC4                                                                     | Update build and deploy job config, [job-config](https://github.com/Sunbird-inQuiry/inquiry-api-service/tree/release-5.2.0/scripts/jenkins-jobs)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Build/job/KnowledgePlatform/InquiryFlinkJob | release-5.2.0\_RC3   | Deploy/KnowledgePlatform/InquiryFlinkJob | release-5.2.0\_RC3                                                                     | create build, deploy and artifactupload jobs, [job-config](https://github.com/Sunbird-inQuiry/inquiry-api-service/tree/release-5.2.0/scripts/jenkins-jobs)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Build/Core/Learner                          | release-5.0.1\_RC2   | Deploy/Kubernetes/Learner                | release-5.1.0\_RC6                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Core/Lms                              | release-5.0.1\_RC3   | Deploy/Kubernetes/Lms                    | release-5.1.0\_RC6                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Core/Cert                             | release-5.0.1\_RC2   | Deploy/Kubernetes/Cert                   | release-5.1.0\_RC6                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Lern/LernDataProducts                 | release-5.0.1\_RC4   | Deploy/Lern/LernDataProducts             | release-5.0.1\_RC4                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Lern/LernFlinkJobs                    | release-5.0.1\_RC5   | Deploy/Lern/LernFlinkJobs                | release-5.0.1\_RC5                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Plugins/ContentEditor                 | release-5.2.0\_RC1   | Deploy/Plugins/ContentEditor             | release-5.1.0\_RC5                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Plugins/ContentPlugins                | release-5.2.0\_RC1   | Deploy/Plugins/ContentPlugins            | release-5.0.0\_RC5                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Plugins/GenericEditor                 | release-5.2.0\_RC1   | Deploy/Plugins/GenericEditor             | release-5.0.0\_RC5                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Core/Player                           | release-5.1.0\_RC30  | Deploy/Kubernetes/Player                 | release-5.1.0\_RC5                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                             |                      | <p>Deploy/Kubernetes/OnboardAPI<br></p>  | release-5.1.0\_RC5                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                             |                      | Deploy/Kubernetes/OnboardConsumers       | release-5.1.0\_RC5                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                             |                      | Deploy/Kubernetes/nginx-public-ingress   | release-5.1.0\_RC5                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/Core/Analytics                        | release-5.1.0\_RC2   | Deploy/Kubernetes/Analytics              | release-5.1.0\_RC3                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/managed-learn/ml-projects-service     | release-5.1.0\_RC29  | Deploy/managed-learn/ml-projects-service | release-5.1.0\_RC7                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/managed-learn/ml-core-service         | release-5.1.0\_RC8   | Deploy/managed-learn/ml-core-service     | release-5.1.0\_RC7                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Build/managed-learn/ml-reports-service      | release-5.1.0\_RC8\_ | Deploy/managed-learn/ml-reports-service  | release-5.1.0\_RC7                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

****

**Variables to update for Ed and vdn**

| variable name                             | description                                                                                                                                                                                                             | Value                                                                                                                                                                                                                                                                  |
| ----------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| cloudstorage\_replace\_absolute\_path     | Boolean value is required to enable/disable cloud storage agnostic urls in db. Update in core/common.yml and KnowledgePlatform/common.yml                                                                               | 'true'                                                                                                                                                                                                                                                                 |
| cloudstorage\_base\_path                  | String value is required. The value could be either cloud specific base path or cname configured for current cloud storage provider.                         Update in core/common.yml and KnowledgePlatform/common.yml | ex:                               storage url: "https://storagename.blob.core.windows.net"        cname url:  [https://obj.stage.sunbirded.org](https://obj.stage.sunbirded.org)                                                                                       |
| valid\_cloudstorage\_base\_urls           | Array of String value is required. This array will have list of all cloud path which should be accepted by service.                                        Update in core/common.yml and KnowledgePlatform/common.yml   | ex: '\["https://storagename.blob.core.windows.net","https://obj.stage.sunbirded.org"]'                                                                                                                                                                                 |
| cloudstorage\_relative\_path\_prefix      | String value is required. This value will be used as prefix for any metadata which holds cloud storage path. Update in Core/common.yml and KnowledgePlatform/common.yml                                                 | CONTENT\_STORAGE\_BASE\_PATH                                                                                                                                                                                                                                           |
| cloudstorage\_metadata\_list              | Array of String value is required. This array will have list of metadata keys which holds cloud storage path. Update in Core/common.yml                                                                                 | \["appIcon","posterImage","artifactUrl","downloadUrl","variants","previewUrl","pdfUrl"]                                                                                                                                                                                |
| cloud\_storage\_base\_url                 | storage url, Update in Core/common.yml.                                                                                                                                                                                 | ex: "https://storagename.blob.core.windows.n                                                                                                                                                                                                                           |
| cloud\_storage\_cname\_url                | cname url, Update in Core/common.yml                                                                                                                                                                                    | ex: "https://obj.stage.sunbirded.org"                                                                                                                                                                                                                                  |
| lern variables to be updated in inventory | update Lern/common.yml                                                                                                                                                                                                  | [https://lern.sunbird.org/use/release-notes/release-v-5.0.1#ansible-changes-need-to-be-updated-in-common.yml-secrets.yml-hosts.yml](https://lern.sunbird.org/use/release-notes/release-v-5.0.1#ansible-changes-need-to-be-updated-in-common.yml-secrets.yml-hosts.yml) |
| cloud\_service\_provider                  | Update in core, kp, dp common.yml                                                                                                                                                                                       | Supported values are aws, azure, gcloud                                                                                                                                                                                                                                |
| lp\_vault\_youtube\_api\_key              | youtube api key. Add in core/common.yml                                                                                                                                                                                 | copy value from KP secrets file                                                                                                                                                                                                                                        |
| cloud\_storage\_url                       | storage url                                                                                                                                                                                                             | ex: "https://storagename.blob.core.windows.n                                                                                                                                                                                                                           |



### Add below variables in Core,KnowledgePlatform and Datapipeline inventory for ED and vdn&#x20;

Refer to variables and comment section from here [link](https://github.com/project-sunbird/sunbird-devops/blob/6ab68620854580256361bb9fb7b8e703656e35b4/private\_repo/ansible/inventory/dev/Core/common.yml#L23-L36) to update below variables.&#x20;

storage\_endpoint variables for public, private, management and artifact is not required in current release, give empty string as value (cloud\_public\_storage\_endpoint, cloud\_private\_storage\_endpoint, etc)

```
// ###### common.yml ###############

cloud_public_storage_accountname: ""
cloud_public_storage_endpoint: ""
cloud_public_storage_region: ""
cloud_public_storage_project: ""

cloud_private_storage_accountname: ""
cloud_private_storage_endpoint: ""
cloud_private_storage_region: ""
cloud_private_storage_project: ""

cloud_management_storage_accountname: ""
cloud_management_storage_endpoint: ""
cloud_management_storage_region: ""
cloud_management_storage_project: ""

cloud_artifact_storage_accountname: ""
cloud_artifact_storage_endpoint: ""
cloud_artifact_storage_region: ""
cloud_artifact_storage_project: ""
```

Refer to variables and comment section from here [link](https://github.com/project-sunbird/sunbird-devops/blob/6ab68620854580256361bb9fb7b8e703656e35b4/private\_repo/ansible/inventory/dev/Core/secrets.yml#L11-L42) to update below secrets variables

```
// ########## secrets.yml ###############
cloud_public_storage_secret: ""
cloud_private_storage_secret: ""
cloud_management_storage_secret: ""
cloud_artifact_storage_secret: ""

```

Refer to variables and comment section from here [link](https://github.com/project-sunbird/sunbird-devops/blob/6ab68620854580256361bb9fb7b8e703656e35b4/private\_repo/ansible/inventory/dev/Core/common.yml#L39-L105) to update below variables

```
// ############# common.yml ##############
cloud_storage_certqr_bucketname: "certqr"
cloud_storage_chatbot_bucketname: "chatbot"
cloud_storage_dial_bucketname: "dial"
cloud_storage_flink_bucketname: "flink-state-backend"
cloud_storage_playercdn_bucketname: "player"
cloud_storage_public_bucketname: "public"
cloud_storage_publicreports_bucketname: "public-reports"
cloud_storage_privatereports_bucketname: "reports"
cloud_storage_samiksha_bucketname: "samiksha"
cloud_storage_schema_bucketname: "schema"
cloud_storage_sourcing_bucketname: "sourcing"
cloud_storage_offlineinstaller_bucketname: "{{env}}-offlineinstaller"
cloud_storage_content_bucketname: "sunbird-content-{{env}}"
cloud_storage_telemetry_bucketname: "telemetry-data-store"
cloud_storage_termsandcondtions_bucketname: "termsandcondtions"
cloud_storage_user_bucketname: "user"
cloud_storage_desktopappcrashlogs_bucketname: "desktopappcrashlogs"
cloud_storage_label_bucketname: "label"
cloud_storage_certservice_bucketname: "{{env}}-e-credentials"
cloud_storage_uci_bucketname: "uci-staging"
cloud_storage_cassandrabackup_bucketname: "cassandra-backup"
cloud_storage_dpcassandrabackup_bucketname: "dp-cassandra-backup"
cloud_storage_dppostgresbackup_bucketname: "dp-postgresql-backup"
cloud_storage_dpredisbackup_bucketname: "dp-redis-backup"
cloud_storage_esbackup_bucketname: "elasticsearch-snapshots"
cloud_storage_influxdbbackup_bucketname: "influxdb-backup"
cloud_storage_jenkinsbackup_bucketname: "jenkins-backup"
cloud_storage_mongobackup_bucketname: "mongodb-backup"
cloud_storage_neo4jbackup_bucketname: "neo4j-backup"
cloud_storage_redisbackup_bucketname: "redis-backup"
cloud_storage_artifacts_bucketname: "{{ artifacts_container }}"
```

> **Variables to remove from inventory**
>
> delete below variables from core/common.yml if its defined.
>
> `upstream_url`&#x20;
>
> `plugin_upstream_url`&#x20;
>
> `discussion_upstream_url`

**Migrations**

Please execute the migration instructions mentioned by the dependent building blocks

| Building Block | Migration Instructions link                                                                                                                                                                                                                    |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Knowlg         | [https://knowlg.sunbird.org/learn/product-and-developer-guide/other/data-migration](https://knowlg.sunbird.org/learn/product-and-developer-guide/other/data-migration)                                                                         |
| InQuiry        | [https://project-sunbird.atlassian.net/wiki/spaces/SBDES/pages/3259105331/inQuiry+CSP+migration+verification+steps](https://project-sunbird.atlassian.net/wiki/spaces/SBDES/pages/3259105331/inQuiry+CSP+migration+verification+steps)         |
| Lern           | [https://lern.sunbird.org/use/release-notes/release-v-5.0.1#data-migrations-run-these-scripts-after-service-deployment](https://lern.sunbird.org/use/release-notes/release-v-5.0.1#data-migrations-run-these-scripts-after-service-deployment) |



**CoKreat Deployments and migration**

Please follow the instructions mentioned in the below link by CoKreat building block to upgrade CoKreat from 5.0.0 to 5.1.0

{% hint style="info" %}
Variables lists and build tag is same for Ed and vdn. Use release-5.1.0-vdn\_RC1 for knowlg service deployments in VDN
{% endhint %}

{% embed url="https://cokreat.sunbird.org/use/release-notes/cokreat-release-v5.1.0-upcoming-release#jenkins-jobs" %}

